# Example options file for zenslam
application:
  log_level: "trace"
  log_pattern: "[%H:%M:%S.%e] [%^%L%$] [%!:%s:%#] %v"

folder:
  root: /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/mav0
  left: cam0/data
  right: cam1/data
  timescale: 1.0E-9
  calibration_file:     /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/dso/camchain.yaml
  groundtruth_file:     /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/dso/gt_imu.csv
  imu_calibration_file: /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/dso/imu_config.yaml
  imu_file:             /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/mav0/imu0/data.csv
  output:               /Volumes/DATA01/results/tumvi/dataset-corridor1_1024_16

# GUI and Visualization Configuration
gui:
  show_keypoints:        true   # show keypoints in visualization
  show_keylines:         true   # show keylines in visualization
  keyline_single_color: [0, 255, 255] # color for keylines when not using multiple colors
  keyline_match_color:  [0, 255, 0]   # color for keyline matches
  keyline_thickness:     1

slam:
  integrator_method: "lpm"   # Options: "lpm" (linear preintegrated measurements), "ugpm" (unified gaussian preintegrated measurements)
  matcher:    "KNN"      # Matcher type: BRUTE (cross-check) or KNN (with ratio test)
  matcher_ratio:  0.8     # Ratio test threshold for KNN matching (0.0-1.0, typically 0.75-0.85)

  triangulation_reprojection_threshold: 1.0    # (in pixels) min distance between keypoints in left and right image to be considered for triangulation
  triangulation_min_depth: 0.1    # (in m) minimum depth for triangulated points to be considered valid, helps filter out noise and points at infinity
  triangulation_max_depth: 20.0  # (in m) maximum depth for triangulated points to be considered valid, helps filter out outliers
  epipolar_threshold:    1.0    # (in pixels) max distance from the epipolar line for a match to be considered valid in stereo matching
  thresdhold_3d3d:       0.005  # (in m) reprojection error threshold for 3D-3D RANSAC pose estimation, points below this threshold are considered inliers
  thresdhold_3d2d:       1.0    # (in pixels) reprojection error threshold for 3D-2D RANSAC pose estimation, points below this threshold are considered inliers
  reprojection_threshold_3d2d: 2.0   # (in pixels) reprojection error threshold for 3D-2D landmark matching, outliers with higher error are filtered
  frustum_margin:        50.0   # (in pixels) margin for frustum culling, allows landmarks slightly outside image bounds to be considered
  enable_frustum_culling: true  # Enable frustum culling to skip landmarks outside camera field of view (improves matching performance)

  # detection configuration (nested)
  detection:
    feature_detector: "FAST"  # Options: "FAST", "ORB", "SIFT"
    descriptor: "ORB"         # Options: "ORB", "SIFT"
    cell_size: [ 64, 64 ]     # Size of grid cells for spatially uniform feature detection, smaller cells lead to more uniform distribution but higher computational cost
    fast_threshold: 10           # FAST feature detector threshold, lower values lead to more features but potentially more noise
    keyline_max_length: 128     # Maximum length of keylines in pixels, longer keylines are often less stable and more likely to be outliers
    clahe_enabled: true         # Enable CLAHE (Contrast Limited Adaptive Histogram Equalization) for better feature detection in low-contrast areas, can improve performance in challenging lighting conditions but adds computational overhead
    use_parallel_detector: true     # Enable parallel feature detection across image cells, can significantly speed up detection on multi-core CPUs but may increase memory usage

  # Tracking configuration (nested)
  tracking:
    klt_window_size: [ 31, 31 ]
    klt_max_level: 3
    klt_threshold: 1.0
    klt_min_tracked_ratio: 0.6
    landmark_match_distance: 32.0   # Max descriptor distance for 2D->3D landmark association
    landmark_match_radius: 20.0     # Radius (m) around camera for 2D->3D landmark association
    use_keylines: false             # Use keylines for tracking, can improve robustness in low-texture environments but may increase computational cost

  # Keyframe selection configuration (nested)
  keyframe:
    min_frames: 5             # Minimum frames between keyframes
    max_frames: 30            # Maximum frames between keyframes
    min_translation: 0.15     # Minimum translation (m) to trigger a keyframe
    min_rotation_deg: 10.0    # Minimum rotation (deg) to trigger a keyframe
    min_tracked_ratio: 0.6    # Minimum tracked ratio before forcing a keyframe
    min_inliers: 20           # Minimum inliers before forcing a keyframe
  
  # PnP RANSAC Configuration (nested)
  pnp:
    iterations: 1000             # Maximum RANSAC iterations for PnP estimation
    threshold: 3.0               # Inlier threshold in pixels for PnP RANSAC
    confidence: 0.99             # RANSAC confidence level (0.0-1.0)
    use_refinement: true        # Use iterative Levenberg-Marquardt refinement after RANSAC
    min_refinement_inliers: 4    # Minimum inliers required for Levenberg-Marquardt refinement
  
  # Essential Matrix Configuration (2D-2D pose estimation, nested)
  essential:
    confidence: 0.999            # RANSAC confidence level for essential matrix
    threshold: 1.0               # Inlier threshold in pixels
    min_inliers: 5               # Minimum required inliers
  
  # 3D-3D Rigid Transformation Configuration (nested)
  rigid:
    threshold: 0.1               # RANSAC threshold in meters for 3D-3D registration
    iterations: 1000             # Maximum RANSAC iterations for rigid transformation
    min_correspondences: 3       # Minimum required 3D-3D correspondences
  
  keyline_mask_margin: 10        # Keyline mask margin in pixels for detector
  
  stereo_rectify: false   # if true, stereo images will be rectified before processing, else only simple undistortion is applied
