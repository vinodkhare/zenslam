# Example options file for zenslam
application:
  log_level: "trace"
  log_pattern: "[%H:%M:%S.%e] [%^%L%$] [%!:%s:%#] %v"

folder:
  root: /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/mav0
  left: cam0/data
  right: cam1/data
  timescale: 1.0E-9
  calibration_file:     /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/dso/camchain.yaml
  groundtruth_file:     /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/dso/gt_imu.csv
  imu_calibration_file: /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/dso/imu_config.yaml
  imu_file:             /Volumes/DATA01/data/tumvi/dataset-corridor1_1024_16/mav0/imu0/data.csv
  output:               /Volumes/DATA01/results/tumvi/dataset-corridor1_1024_16

# GUI and Visualization Configuration
gui:
  show_keypoints:        true   # show keypoints in visualization
  show_keylines:         true   # show keylines in visualization
  keyline_single_color: [0, 255, 255] # color for keylines when not using multiple colors
  keyline_match_color:  [0, 255, 0]   # color for keyline matches
  keyline_thickness:     1

slam:
  cell_size: [ 64, 64 ]
  clahe_enabled: false
  integrator_method: "lpm"   # Options: "lpm" (linear preintegrated measurements), "ugpm" (unified gaussian preintegrated measurements)
  feature:    "FAST"
  descriptor: "ORB"
  matcher:    "BRUTE"      # Matcher type: BRUTE (cross-check) or KNN (with ratio test)
  matcher_ratio:  0.8     # Ratio test threshold for KNN matching (0.0-1.0, typically 0.75-0.85)
  fast_threshold: 1
  use_parallel_detector: true
  klt_window_size: [ 15, 15 ]
  klt_max_level: 3
  klt_threshold: 1.0
  triangulation_reprojection_threshold: 1.0    # (in pixels) min distance between keypoints in left and right image to be considered for triangulation
  epipolar_threshold:    1.0    # (in pixels) max distance from the epipolar line for a match to be considered valid in stereo matching
  thresdhold_3d3d:       0.005  # (in m) reprojection error threshold for 3D-3D RANSAC pose estimation, points below this threshold are considered inliers
  thresdhold_3d2d:       1.0    # (in pixels) reprojection error threshold for 3D-2D RANSAC pose estimation, points below this threshold are considered inliers
  reprojection_threshold_3d2d: 2.0   # (in pixels) reprojection error threshold for 3D-2D landmark matching, outliers with higher error are filtered
  frustum_margin:        50.0   # (in pixels) margin for frustum culling, allows landmarks slightly outside image bounds to be considered
  enable_frustum_culling: true  # Enable frustum culling to skip landmarks outside camera field of view (improves matching performance)

  # Keyframe selection configuration (nested)
  keyframe:
    min_frames: 5             # Minimum frames between keyframes
    max_frames: 30            # Maximum frames between keyframes
    min_translation: 0.15     # Minimum translation (m) to trigger a keyframe
    min_rotation_deg: 10.0    # Minimum rotation (deg) to trigger a keyframe
    min_tracked_ratio: 0.6    # Minimum tracked ratio before forcing a keyframe
    min_inliers: 20           # Minimum inliers before forcing a keyframe
  
  # PnP RANSAC Configuration (nested)
  pnp:
    iterations: 1000             # Maximum RANSAC iterations for PnP estimation
    threshold: 3.0               # Inlier threshold in pixels for PnP RANSAC
    confidence: 0.99             # RANSAC confidence level (0.0-1.0)
    use_refinement: true         # Use iterative Levenberg-Marquardt refinement after RANSAC
    min_refinement_inliers: 4    # Minimum inliers required for Levenberg-Marquardt refinement
  
  # Essential Matrix Configuration (2D-2D pose estimation, nested)
  essential:
    confidence: 0.999            # RANSAC confidence level for essential matrix
    threshold: 1.0               # Inlier threshold in pixels
    min_inliers: 5               # Minimum required inliers
  
  # 3D-3D Rigid Transformation Configuration (nested)
  rigid:
    threshold: 0.1               # RANSAC threshold in meters for 3D-3D registration
    iterations: 1000             # Maximum RANSAC iterations for rigid transformation
    min_correspondences: 3       # Minimum required 3D-3D correspondences
  
  keyline_mask_margin: 10        # Keyline mask margin in pixels for detector
  
  stereo_rectify:        true   # if true, stereo images will be rectified before processing, else only simple undistortion is applied
